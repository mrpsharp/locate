function getLocation(){infoMessage("Finding location..."),navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition,showError):document.getElementById("info-div").innerHTML="Geolocation is not supported by this browser."}function showPosition(e){var o={lat:e.coords.latitude,lng:e.coords.longitude},e=e.coords.accuracy;let t=e.toLocaleString(void 0,{maximumFractionDigits:0}),r=(250<e?showErrorButton("Accuracy is low."):hideErrorButton(),convertToOSGridRef(o)),n;r&&(infoMessage(infoHTML=`<p>Your grid reference is</p><p class="gridref">${r}</p><p>Based on an accuracy of ${t}m`),n=`https://explore.osmaps.com/pin?lat=${o.lat}&lon=${o.lng}&zoom=16`,document.getElementById("result-links").style.display="block",document.getElementById("osmaps-link").setAttribute("href",n),new URLSearchParams(window.location.search).has("testing")&&(document.getElementById("osmaps-link").style.display="block"),document.getElementById("share-link").addEventListener("click",()=>shareLocation(r,t)))}function convertToOSGridRef(e){proj4.defs("EPSG:27700","+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +towgs84=446.448,-125.157,542.06,0.15,0.247,0.842,-20.489 +units=m +no_defs");var o=os.Transform._checkBounds(e);if(o.valid)return e=os.Transform.fromLatLng(e),(e=os.Transform.toGridRef(e)).letters+" "+e.eastings.substring(0,3)+e.northings.substring(0,3);showErrorButton(o.message)}function shareLocation(o,e){o=`At ${(d=new Date).toLocaleTimeString()} on ${d.toLocaleDateString()} my location was ${o}, with an accuracy of ${e}m. View location online: `+document.getElementById("osmaps-link").getAttribute("href");if(navigator.share)try{navigator.share({text:o})}catch(e){alternateShare(o)}else alternateShare(o)}function alternateShare(e){(altShareDiv=document.getElementById("alt-share-div")).style.display="block";var o=document.createElement("h4"),t=(o.textContent="Error sharing, copy text below",document.createElement("p"));t.textContent=e,altShareDiv.appendChild(o),altShareDiv.appendChild(t)}function showError(e){switch(e.code){case e.PERMISSION_DENIED:showErrorButton("User denied the request for Geolocation.");break;case e.POSITION_UNAVAILABLE:showErrorButton("Location information is unavailable.");break;case e.TIMEOUT:showErrorButton("The request to get user location timed out.");break;case e.UNKNOWN_ERROR:showErrorButton("An unknown error occurred.")}}function showErrorButton(e){(errorButton=document.getElementById("error-btn")).style.display="block",errorButton.innerHTML=e+" Tap to refresh",infoMessage(infoHTML='Error finding your grid reference. You may have success with <a href="https://locate.what3words.com">What3Words Locate</a> instead'),errorButton.addEventListener("click",getLocation)}function hideErrorButton(){document.getElementById("error-btn").style.display="None"}function infoMessage(e){document.getElementById("info-message").innerHTML=e}"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.min.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)},function(e){console.log("ServiceWorker registration failed: ",e)})});